app:
  description: æœ¬å·¥ä½œæµä¸»è¦æ˜¯å®ç°å³æ¢¦AIé€†å‘API ä½¿ç”¨æ¢¦ AI 4.0 æ–‡ç”Ÿå›¾ã€å›¾ç”Ÿå›¾æ¨¡å‹
  icon: ğŸ¤–
  icon_background: '#FFEAD5'
  mode: advanced-chat
  name: 83-difyæ¡ˆä¾‹åˆ†äº«-å…è´¹ç©è½¬å³æ¢¦ 4.0 å¤šå›¾ç”Ÿæˆï¼Dify å·¥ä½œæµä»æ­å»ºåˆ°ä½¿ç”¨å…¨æ”»ç•¥ï¼Œé™„æ¡ˆä¾‹æ•ˆæœ
  use_icon_as_answer_icon: false
dependencies: []
kind: app
version: 0.4.0
workflow:
  conversation_variables: []
  environment_variables:
  - description: ''
    id: 70dcbaf8-d37c-4884-b342-2177f1a32872
    name: url
    selector:
    - env
    - url
    value: https://jimeng.duckcloud.fun/v1/images/compositions
    value_type: string
  - description: ''
    id: 79f456ae-bdfb-48f2-88b5-fd4ed87dbbba
    name: jimengsessionid
    selector:
    - env
    - jimengsessionid
    value: ä½ çš„å³æ¢¦cookies å¯ä»¥æ”¯æŒå¤šä¸ª
    value_type: string
  features:
    file_upload:
      allowed_file_extensions:
      - .JPG
      - .JPEG
      - .PNG
      - .GIF
      - .WEBP
      - .SVG
      allowed_file_types:
      - image
      allowed_file_upload_methods:
      - local_file
      - remote_url
      enabled: false
      fileUploadConfig:
        audio_file_size_limit: 500
        batch_count_limit: 50
        file_size_limit: 100
        image_file_size_limit: 100
        video_file_size_limit: 500
        workflow_file_upload_limit: 10
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      number_limits: 3
    opening_statement: "æ¬¢è¿ä½¿ç”¨æœ€æ–°çš„å³æ¢¦4.0æ–‡ç”Ÿå›¾ï¼Œå›¾ç”Ÿå›¾å·¥ä½œæµï¼ˆè¯·å‚è€ƒä¸‹é¢çš„æç¤ºè¯å¤åˆ¶promptä¸­ï¼‰\n 1 å•ä¸ªæ–‡ç”Ÿå›¾ï¼ˆæç¤ºè¯å‚è€ƒï¼šç»™æˆ‘ç”»ä¸€ä¸ªå°ç‹—åœ¨çƒåœºä¸Šè·‘æ­¥ï¼‰\n\
      \ 2 å¤šä¸ªæ–‡ç”Ÿå›¾ï¼ˆæç¤ºè¯å‚è€ƒï¼šè¯·ç»™æˆ‘ç”Ÿæˆ4å¼ è¿ç»­çš„å„¿ç«¥æ•…äº‹ç»˜æœ¬-å°æ¾é¼ å’Œå°èŠ±çŒ«ï¼‰\n 3 å›¾ç”Ÿå›¾ ï¼ˆæç¤ºè¯å‚è€ƒï¼šè¯·æŠŠè¿™ä¸ª2ä¸ªå›¾ç‰‡è¿›è¡Œåˆæˆï¼‰"
    retriever_resource:
      enabled: true
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: start
        targetType: if-else
      id: 1756864683426-source-1756864928121-target
      source: '1756864683426'
      sourceHandle: source
      target: '1756864928121'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: http-request
      id: 1756864928121-true-1756865047041-target
      source: '1756864928121'
      sourceHandle: 'true'
      target: '1756865047041'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: http-request
        targetType: code
      id: 1756865047041-source-1756865210521-target
      source: '1756865047041'
      sourceHandle: source
      target: '1756865210521'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: code
        targetType: answer
      id: 1756865210521-source-answer-target
      source: '1756865210521'
      sourceHandle: source
      target: answer
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: answer
      id: 1756864928121-false-1756865493137-target
      source: '1756864928121'
      sourceHandle: 'false'
      target: '1756865493137'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: if-else
        targetType: code
      id: 1756864928121-f3e06ee6-8378-4d0a-81a4-486a26890636-1757431303396-target
      source: '1756864928121'
      sourceHandle: f3e06ee6-8378-4d0a-81a4-486a26890636
      target: '1757431303396'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: code
        targetType: answer
      id: 1757431303396-source-1757430002530-target
      source: '1757431303396'
      sourceHandle: source
      target: '1757430002530'
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        desc: ''
        selected: false
        title: å¼€å§‹
        type: start
        variables:
        - label: æç¤ºè¯
          max_length: 256
          options: []
          required: true
          type: text-input
          variable: prompt
        - label: ç±»å‹
          max_length: 48
          options:
          - æ–‡ç”Ÿå›¾
          - å›¾ç”Ÿå›¾
          required: true
          type: select
          variable: type
        - label: æ–‡ç”Ÿå›¾æ¨¡å‹
          max_length: 48
          options:
          - jimeng-4.0
          - jimeng-3.1
          - jimeng-2.1
          - jimeng-2.0-pro
          - jimeng-2.0
          - jimeng-1.4
          - jimeng-xl-pro
          required: true
          type: select
          variable: pmodel
        - allowed_file_extensions: []
          allowed_file_types:
          - image
          allowed_file_upload_methods:
          - local_file
          - remote_url
          label: å›¾ç‰‡
          max_length: 5
          options: []
          required: false
          type: file-list
          variable: picture
      height: 167
      id: '1756864683426'
      position:
        x: 80
        y: 282
      positionAbsolute:
        x: 80
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        answer: '{{#1756865210521.result#}}'
        desc: ''
        selected: false
        title: ç›´æ¥å›å¤
        type: answer
        variables: []
      height: 104
      id: answer
      position:
        x: 1326
        y: 271
      positionAbsolute:
        x: 1326
        y: 271
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: is
            id: cecd6444-e31d-4c36-abb4-c3b06b517892
            value: æ–‡ç”Ÿå›¾
            varType: string
            variable_selector:
            - '1756864683426'
            - type
          id: 'true'
          logical_operator: and
        - case_id: f3e06ee6-8378-4d0a-81a4-486a26890636
          conditions:
          - comparison_operator: is
            id: 70654f8e-c422-41dd-aec7-88f1ab3295da
            value: å›¾ç”Ÿå›¾
            varType: string
            variable_selector:
            - '1756864683426'
            - type
          - comparison_operator: not empty
            id: 8805125d-1085-47ce-aeec-79f945b31749
            value: ''
            varType: array[file]
            variable_selector:
            - '1756864683426'
            - picture
          id: f3e06ee6-8378-4d0a-81a4-486a26890636
          logical_operator: and
        desc: ''
        selected: false
        title: æ¡ä»¶åˆ†æ”¯
        type: if-else
      height: 199
      id: '1756864928121'
      position:
        x: 395.6597539488446
        y: 282
      positionAbsolute:
        x: 395.6597539488446
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        authorization:
          config: null
          type: no-auth
        body:
          data:
          - id: key-value-100
            key: ''
            type: text
            value: '{

              "model":"{{#1756864683426.pmodel#}}",

              "prompt":"{{#1756864683426.prompt#}}"

              "negativePrompt":"",

              "width":1536 ,

              "height":864,

              "sample_strength":0.5

              }'
          type: json
        desc: ''
        headers: Authorization:{{#env.jimengsessionid#}}
        method: post
        params: ''
        retry_config:
          max_retries: 1
          retry_enabled: true
          retry_interval: 100
        selected: false
        ssl_verify: true
        timeout:
          connect: 300
          max_connect_timeout: 0
          max_read_timeout: 0
          max_write_timeout: 0
          read: 300
          write: 300
        title: HTTP è¯·æ±‚ï¼ˆæ–‡ç”Ÿå›¾ï¼‰
        type: http-request
        url: https://jimeng.duckcloud.fun/v1/images/generations
        variables: []
      height: 139
      id: '1756865047041'
      position:
        x: 704
        y: 271
      positionAbsolute:
        x: 704
        y: 271
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "def main(arg1: str) -> str:\n    import json\n\n    # è§£æè¾“å…¥çš„ JSON æ•°æ®\n\
          \    try:\n        data = json.loads(arg1)\n    except json.JSONDecodeError:\n\
          \        return \"è¾“å…¥çš„å­—ç¬¦ä¸²ä¸æ˜¯æœ‰æ•ˆçš„ JSON æ ¼å¼ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ•°æ®ã€‚\"\n\n    # ç¡®ä¿è§£æåçš„æ•°æ®åŒ…å« 'data'\
          \ é”®\n    if not isinstance(data, dict) or 'data' not in data:\n        return\
          \ \"è¾“å…¥çš„æ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·ç¡®ä¿è¾“å…¥æ˜¯ä¸€ä¸ªåŒ…å« 'data' é”®çš„ JSON å¯¹è±¡ã€‚\"\n\n    # è·å– 'data' é”®å¯¹åº”çš„æ•°ç»„æ•°æ®\n\
          \    image_data = data.get('data', [])\n\n    # ç¡®ä¿ 'data' é”®çš„å€¼æ˜¯ä¸€ä¸ªåˆ—è¡¨\n   \
          \ if not isinstance(image_data, list):\n        return \"è¾“å…¥çš„æ•°æ®ä¸­ 'data' é”®çš„å€¼ä¸æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¯·ç¡®ä¿å…¶å€¼æ˜¯ä¸€ä¸ª\
          \ JSON æ•°ç»„å¯¹è±¡ã€‚\"\n\n    # åˆå§‹åŒ–ç»“æœå­—ç¬¦ä¸²\n    markdown_result = \"\"\n\n    # éå†æ¯æ¡å›¾ç‰‡æ•°æ®\n\
          \    for index, item in enumerate(image_data, start=1):\n        # æ£€æŸ¥æ¯æ¡æ•°æ®æ˜¯å¦æ˜¯å­—å…¸ï¼Œå¹¶ä¸”åŒ…å«\
          \ 'url' å­—æ®µ\n        if not isinstance(item, dict) or 'url' not in item:\n\
          \            markdown_result += f\"å›¾ç‰‡ç¬¬{index}æ¡å†…å®¹ï¼šæ— æ³•æå– URLï¼ˆç¼ºå°‘ 'url' å­—æ®µï¼‰\\\
          n\"\n            continue\n\n        # æå– URL å¹¶ç”Ÿæˆ Markdown æ ¼å¼çš„å›¾ç‰‡é“¾æ¥\n   \
          \     url = item['url']\n        markdown_result += f\"![å›¾ç‰‡{index}]({url})\\\
          n\"\n\n    # è¿”å›æœ€ç»ˆçš„ Markdown å­—ç¬¦ä¸²\n    return {\"result\": markdown_result}"
        code_language: python3
        desc: ''
        outputs:
          result:
            children: null
            type: string
        selected: false
        title: ä»£ç æ‰§è¡Œæ–‡ç”Ÿå›¾
        type: code
        variables:
        - value_selector:
          - '1756865047041'
          - body
          value_type: string
          variable: arg1
      height: 53
      id: '1756865210521'
      position:
        x: 1005.4367571769878
        y: 271
      positionAbsolute:
        x: 1005.4367571769878
        y: 271
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        answer: å¯¹ä¸è¯·ï¼Œæ‚¨è¾“å…¥é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥
        desc: ''
        selected: false
        title: ç›´æ¥å›å¤ 4
        type: answer
        variables: []
      height: 101
      id: '1756865493137'
      position:
        x: 704
        y: 612.1127643571581
      positionAbsolute:
        x: 704
        y: 612.1127643571581
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        answer: '{{#1757431303396.result#}}'
        desc: ''
        selected: false
        title: ç›´æ¥å›å¤ 2
        type: answer
        variables: []
      height: 104
      id: '1757430002530'
      position:
        x: 1046.7037392392917
        y: 441.9308145928902
      positionAbsolute:
        x: 1046.7037392392917
        y: 441.9308145928902
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "import requests\nimport json\nfrom typing import List\n\n\ndef main(pictures:\
          \ List[str], apikey: str, model: str, prompt: str, url: str) -> dict:\n\
          \    # è®¾ç½®è¯·æ±‚çš„URLå’ŒHeaders (ä½¿ç”¨bb.pyçš„APIç«¯ç‚¹)\n    surl = url\n    headers = {\n\
          \        \"Authorization\": f\"Bearer {apikey}\",\n        \"Content-Type\"\
          : \"application/json\"\n    }\n\n    # å®šä¹‰è¯·æ±‚çš„payloadæ•°æ® (åŸºäºbb.pyçš„é€»è¾‘)\n   \
          \ payload = {\n        \"model\": model,\n        \"prompt\": prompt,\n\
          \        \"images\": pictures,  # ä½¿ç”¨ä¼ å…¥çš„picturesæ•°ç»„\n        \"width\": 1536,\n\
          \        \"height\": 864,\n        \"sample_strength\": 0.5\n    }\n\n \
          \   # æ‰“å°payloadç”¨äºè°ƒè¯•\n    print(\"Payload:\", json.dumps(payload, indent=2))\n\
          \    \n    # å‘é€POSTè¯·æ±‚\n    response = requests.post(surl, headers=headers,\
          \ data=json.dumps(payload))\n\n    # æå–ç»“æœå¹¶è¿”å›\n    if response.status_code\
          \ == 200:\n        response_data = response.json()\n        \n        #\
          \ é›†æˆcc.pyçš„å¤„ç†é€»è¾‘\n        def process_image_urls(data):\n            # ç¡®ä¿è§£æåçš„æ•°æ®åŒ…å«\
          \ 'data' é”®\n            if not isinstance(data, dict) or 'data' not in data:\n\
          \                return \"è¾“å…¥çš„æ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·ç¡®ä¿è¾“å…¥æ˜¯ä¸€ä¸ªåŒ…å« 'data' é”®çš„ JSON å¯¹è±¡ã€‚\"\n\n\
          \            # è·å– 'data' é”®å¯¹åº”çš„æ•°ç»„æ•°æ®\n            image_data = data.get('data',\
          \ [])\n\n            # ç¡®ä¿ 'data' é”®çš„å€¼æ˜¯ä¸€ä¸ªåˆ—è¡¨\n            if not isinstance(image_data,\
          \ list):\n                return \"è¾“å…¥çš„æ•°æ®ä¸­ 'data' é”®çš„å€¼ä¸æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œè¯·ç¡®ä¿å…¶å€¼æ˜¯ä¸€ä¸ª JSON\
          \ æ•°ç»„å¯¹è±¡ã€‚\"\n\n            # åˆå§‹åŒ–ç»“æœå­—ç¬¦ä¸²\n            markdown_result = \"\"\n\
          \n            # éå†æ¯æ¡å›¾ç‰‡æ•°æ®\n            for index, item in enumerate(image_data,\
          \ start=1):\n                # æ£€æŸ¥æ¯æ¡æ•°æ®æ˜¯å¦æ˜¯å­—å…¸ï¼Œå¹¶ä¸”åŒ…å« 'url' å­—æ®µ\n             \
          \   if not isinstance(item, dict) or 'url' not in item:\n              \
          \      markdown_result += f\"å›¾ç‰‡ç¬¬{index}æ¡å†…å®¹ï¼šæ— æ³•æå– URLï¼ˆç¼ºå°‘ 'url' å­—æ®µï¼‰\\n\"\n\
          \                    continue\n\n                # æå– URL å¹¶ç”Ÿæˆ Markdown æ ¼å¼çš„å›¾ç‰‡é“¾æ¥\n\
          \                url = item['url']\n                markdown_result += f\"\
          ![å›¾ç‰‡{index}]({url})\\n\"\n\n            # è¿”å›æœ€ç»ˆçš„ Markdown å­—ç¬¦ä¸²\n         \
          \   return markdown_result\n        \n        # å¤„ç†å“åº”æ•°æ®å¹¶ç”ŸæˆMarkdownç»“æœ\n  \
          \      markdown_result = process_image_urls(response_data)\n        return\
          \ {\"result\": markdown_result}\n    else:\n        return {\"error\": f\"\
          Error: {response.status_code}, {response.text}\"}"
        code_language: python3
        desc: ''
        outputs:
          result:
            children: null
            type: string
        selected: false
        title: ä»£ç æ‰§è¡Œå›¾ç”Ÿå›¾æ¥å£
        type: code
        variables:
        - value_selector:
          - '1756864683426'
          - picture
          value_type: array[file]
          variable: pictures
        - value_selector:
          - env
          - jimengsessionid
          value_type: string
          variable: apikey
        - value_selector:
          - '1756864683426'
          - pmodel
          value_type: string
          variable: model
        - value_selector:
          - '1756864683426'
          - prompt
          value_type: string
          variable: prompt
        - value_selector:
          - env
          - url
          value_type: string
          variable: url
      height: 53
      id: '1757431303396'
      position:
        x: 704
        y: 441.9308145928902
      positionAbsolute:
        x: 704
        y: 441.9308145928902
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    viewport:
      x: -476.61194213377917
      y: -73.60016597976414
      zoom: 1.2311444194486532
